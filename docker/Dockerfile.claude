ARG BASE=ghcr.io/raine/workmux-sandbox:base
FROM ${BASE}

# Install Claude Code, then move to a globally accessible path so the binary
# is reachable when running as an arbitrary non-root UID (--user uid:gid).
RUN curl -fsSL https://claude.ai/install.sh | bash && \
    target="$(readlink -f /root/.local/bin/claude)" && \
    mv /root/.local/share/claude /opt/claude && \
    ln -s "/opt/claude/versions/$(basename "$target")" /usr/local/bin/claude && \
    # Claude Code checks $HOME/.local/bin/claude when installMethod is "native".
    # Container sets HOME=/tmp, so place a symlink to suppress the warning.
    mkdir -p /tmp/.local/bin && \
    ln -s /usr/local/bin/claude /tmp/.local/bin/claude
